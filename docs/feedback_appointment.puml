@startuml feedback_appointment

title Cancelling an Appointment Flow

actor "User" as user
participant "Appointment Service" as appointment_service
queue "Feedback Topic" as topic
participant "Database" as database

note over user
In this example, the user must
be a **patient**.
end note

user -> appointment_service: POST /appointments/{appointmentId}/feedbacks\n(Bearer JWT)

activate appointment_service
appointment_service -> appointment_service: Must be informed a rating\nand a comment
appointment_service -> database: Load the appointment
database --> appointment_service: Returns the appointment
appointment_service -> appointment_service: Create a new feedback event
appointment_service -> topic: Send an event with\nthe feedback details
topic --> appointment_service: Return the message ID
appointment_service -> database: Store the event details
database --> appointment_service: Event stored
appointment_service --> user: 201 Created
deactivate appointment_service


@enduml